<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Fluxo de Mensagens</title>
  <style>
    body {
      font-family: sans-serif;
      background-color: #f2f2f2;
    }
    .container {
      background-color: white;
      max-width: 500px;
      margin: 40px auto;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    }
    h1 {
      text-align: center;
      color: #007bff;
      border-bottom: 2px solid #007bff;
      padding-bottom: 10px;
    }
    nav {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-bottom: 20px;
    }
    nav button {
      background-color: #007bff;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
    }
    section {
      display: none;
    }
    section.active {
      display: block;
    }
    label {
      font-weight: bold;
      display: block;
      margin-top: 10px;
    }
    input, textarea {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
    .copiar {
      background-color: green;
      color: white;
      font-weight: bold;
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      margin-top: 10px;
      width: 100%;
    }
    #resultadoPesquisa {
      resize: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Fluxo de Mensagens</h1>

    <nav>
      <button onclick="mostrarSecao('pesquisar')">Pesquisar</button>
      <button onclick="mostrarSecao('adicionar')">Adicionar</button>
      <button onclick="mostrarSecao('alterar')">Alterar</button>
    </nav>

    <div style="margin: 10px 0;">
      <label><strong>Importar CSV:</strong></label>
      <input type="file" id="importarCsv" accept=".csv" onchange="importarCSV()" />
      <br/><br/>
      <button onclick="exportarCSV()" style="width: 100%; background-color: #ff9800; color: white; padding: 10px; border: none; border-radius: 5px;">Exportar CSV</button>
    </div>

    <section id="pesquisar" class="active">
      <label for="pesqAtalho">Atalho:</label>
      <input id="pesqAtalho" oninput="pesquisarMensagem()" placeholder="Digite o atalho para pesquisar" autocomplete="off" />
      <textarea id="resultadoPesquisa" rows="6" readonly></textarea>
      <button onclick="copiarMensagem()" class="copiar">Copiar</button>
    </section>

    <section id="adicionar">
      <label for="novoAtalho">Novo atalho:</label>
      <input id="novoAtalho" placeholder="Digite o novo atalho" autocomplete="off" />
      <label for="novaMensagem">Mensagem:</label>
      <textarea id="novaMensagem" rows="4" placeholder="Digite a mensagem"></textarea>
      <button onclick="adicionarMensagem()">Adicionar Mensagem</button>
      <div id="msgAdicionar" style="margin-top:10px;color:green;"></div>
    </section>

    <section id="alterar">
      <label for="altAtalho">Atalho existente:</label>
      <input id="altAtalho" placeholder="Digite o atalho" autocomplete="off" />
      <label for="altMensagem">Nova mensagem:</label>
      <textarea id="altMensagem" rows="4" placeholder="Digite a nova mensagem"></textarea>
      <button onclick="alterarMensagem()">Alterar Mensagem</button>
      <div id="msgAlterar" style="margin-top:10px;color:green;"></div>
    </section>
  </div>

  <script>
    const secoes = document.querySelectorAll("section");

    function mostrarSecao(id) {
      secoes.forEach(secao => secao.classList.remove("active"));
      document.getElementById(id).classList.add("active");
    }

    function getMensagens() {
      return JSON.parse(localStorage.getItem("mensagens") || "{}");
    }

    function salvarMensagens(obj) {
      localStorage.setItem("mensagens", JSON.stringify(obj));
    }

    function pesquisarMensagem() {
      const atalho = document.getElementById("pesqAtalho").value.trim();
      const mensagens = getMensagens();
      const mensagem = mensagens[atalho] || "Mensagem não encontrada.";
      document.getElementById("resultadoPesquisa").value = mensagem;
    }

    function adicionarMensagem() {
      const atalho = document.getElementById("novoAtalho").value.trim();
      const mensagem = document.getElementById("novaMensagem").value.trim();
      const mensagens = getMensagens();

      if (!atalho || !mensagem) {
        alert("Preencha todos os campos.");
        return;
      }

      if (mensagens[atalho]) {
        alert("Esse atalho já existe. Use a aba Alterar.");
        return;
      }

      mensagens[atalho] = mensagem;
      salvarMensagens(mensagens);

      document.getElementById("msgAdicionar").textContent = "Mensagem adicionada!";
      document.getElementById("novoAtalho").value = "";
      document.getElementById("novaMensagem").value = "";
    }

    function alterarMensagem() {
      const atalho = document.getElementById("altAtalho").value.trim();
      const novaMensagem = document.getElementById("altMensagem").value.trim();
      const mensagens = getMensagens();

      if (!atalho || !novaMensagem) {
        alert("Preencha todos os campos.");
        return;
      }

      if (!mensagens[atalho]) {
        alert("Esse atalho não existe. Use a aba Adicionar.");
        return;
      }

      mensagens[atalho] = novaMensagem;
      salvarMensagens(mensagens);

      document.getElementById("msgAlterar").textContent = "Mensagem alterada!";
      document.getElementById("altAtalho").value = "";
      document.getElementById("altMensagem").value = "";
    }

    function copiarMensagem() {
      const textarea = document.getElementById("resultadoPesquisa");
      if (!textarea.value.trim()) {
        alert("Nenhuma mensagem para copiar.");
        return;
      }

      textarea.select();
      document.execCommand("copy");
      alert("Mensagem copiada!");
    }

    function importarCSV() {
      const input = document.getElementById("importarCsv");
      const file = input.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function (e) {
        const linhas = e.target.result.split('\n');
        const mensagens = getMensagens();
        let total = 0;

        for (let linha of linhas) {
          linha = linha.trim();
          if (!linha) continue;

          const [atalho, ...msg] = linha.split(',');
          if (!atalho || msg.length === 0) continue;

          mensagens[atalho.trim()] = msg.join(',').trim();
          total++;
        }

        salvarMensagens(mensagens);
        alert(`✅ Importação concluída: ${total} mensagens.`);
        input.value = '';
      };

      reader.readAsText(file);
    }

    function exportarCSV() {
      const mensagens = getMensagens();
      const linhas = Object.entries(mensagens).map(
        ([atalho, mensagem]) => `"${atalho}","${mensagem.replace(/"/g, '""')}"`
      );

      const csv = linhas.join("\n");
      const blob = new Blob([csv], { type: "text/csv" });
      const url = URL.createObjectURL(blob);

      const a = document.createElement("a");
      a.href = url;
      a.download = "mensagens.csv";
      a.click();

      URL.revokeObjectURL(url);
    }
  </script>
</body>
</html>
